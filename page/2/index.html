<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="技术博客，谢谢关注">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="技术博客，谢谢关注">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="技术博客，谢谢关注">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> 技术博客，谢谢关注 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">技术博客，谢谢关注</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">这城市华灯初上，多两个人悲剧散场</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分類
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            關於
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            標籤
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/17/iOS静态代码检查/" itemprop="url">
                  iOS静态代码检查
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-04-17T15:52:46+08:00" content="2016-04-17">
              2016-04-17
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h3 id="前言">前言</h3><p>代码审查是保证代码质量的重要环节，代码审查主要是针对编码规范、代码走查、代码评审、单元测试、集成测试、持续集成、执行流程等编程方面的增强。本章介绍一些关于编码规范、代码评审阶段的一些自动化工具的配置和使用。</p>
<h3 id="准备工作">准备工作</h3><p>我的操作系统为OS X EI Capitan 10.11.3，以下如果不作说明，默认在此环境下。以下工具安装的都是最新版本。</p>
<h4 id="所需工具">所需工具</h4><ol>
<li>SonarQube <a href="http://www.sonarqube.org/downloads/" target="_blank" rel="external">官网下载链接</a></li>
<li>Sonar Runner <a href="http://www.sonarqube.org/downloads/" target="_blank" rel="external">官网下载链接</a></li>
<li>MySQL <a href="http://dev.mysql.com/downloads/mysql/" target="_blank" rel="external">官网下载链接</a></li>
<li>OClint <a href="http://oclint.org/downloads.html" target="_blank" rel="external">官网下载链接</a></li>
<li>xcodebuild (无需单独安装，Xcode自带,如果使用xctool，需要单独下载<a href="https://github.com/facebook/xctool" target="_blank" rel="external">Git链接</a>)</li>
<li>XCPretty (xcodebuild格式化程序)  <a href="https://github.com/mneorr/xcpretty" target="_blank" rel="external">git链接</a></li>
</ol>
<p>以上工具都可以使用brew安装。关于brew不是本文的重点，这里不作介绍。<a href="http://brew.sh/" target="_blank" rel="external">brew官网</a></p>
<h4 id="所需组件">所需组件</h4><p>Sonar Plugin for Objective C<br>可以直接下载Sonar官方提供的sonar-objective-c-plugin-x.x.x-SNAPSHOT.jar，不过这个是收费的。github上有提供的开源代码<a href="https://github.com/octo-technology/sonar-objective-c/tree/oclint" target="_blank" rel="external">sonar-plugin</a>,可以自己下载编译。也可以在网上搜编译安装好的jar文件。</p>
<h3 id="环境搭建">环境搭建</h3><ol>
<li><p>创建sonar用户和sonar数据库</p>
<p>第一次登陆mysql无需密码，直接执行<code>mysql -uroot</code>即可，在安装任何工具的时候都要注意console上的提示信息。</p>
<pre><code><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> sonar <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci;</span>
 <span class="operator"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'sonar'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'sonar'</span>;</span>
 <span class="operator"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> sonar.* <span class="keyword">TO</span> <span class="string">'sonar'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'sonar'</span>;</span>
 <span class="operator"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> sonar.* <span class="keyword">TO</span> <span class="string">'sonar'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'sonar'</span>;</span>
 <span class="operator"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span>
</code></pre></li>
<li><p>安装SonarQube</p>
<p>解压SonarQube到安装目录(如/usr/local/),将sonar- objective-c-plugin-x.x.x-SNAPSHOT.jar放入sonarqube/extensions/plugins下。编辑配置文件sonar.properties。<br>设置数据库为mysql:</p>
<pre><code>sonar<span class="class">.jdbc</span><span class="class">.url</span>=jdbc:mysql:<span class="comment">//localhost:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true&amp;useConfigs=maxPerformance</span>
</code></pre></li>
<li><p>启动SonarQube</p>
<p>终端执行<code>/etc/sonarqube/bin/macosx-universal-64/sonar.sh start</code>启动服务器。如果不想每次都写这么长的命令，可以把Sonar目录配置到环境变量里，或者直接给命令设置alias别名。启动成功会输出以下信息：</p>
<pre><code><span class="string">liudesheng:</span> sheng$ <span class="regexp">/usr/</span>local<span class="regexp">/sonarqube-4.5.6/</span>bin<span class="regexp">/macosx-universal-64/</span>sonar.sh start
  Starting SonarQube...
 Started SonarQube.
</code></pre></li>
<li><p>测试sonarQube</p>
<p> 浏览器输入<code>http://localhost:9000/</code>,出现以下界面:</p>
<p> <img src="http://7xorsh.com1.z0.glb.clouddn.com/indexPage.jpg" alt="Loading" title="http://localhost:9000/"></p>
</li>
<li><p>Sonar Runner安装配置</p>
<p>解压Sonar Runner到指定目录(如/usr/local)，配置Sonar Runner下的sonar-runner.properties。</p>
<pre><code>#----- Default SonarQube server
sonar<span class="class">.host</span><span class="class">.url</span>=http:<span class="comment">//localhost:9000</span>
   #----- MySQL
sonar<span class="class">.jdbc</span><span class="class">.url</span>=jdbc:mysql:<span class="comment">//localhost:3306/sonar?useUnicode=true&amp;amp;characterEncoding=utf8</span>
#----- Global database settings
sonar<span class="class">.jdbc</span><span class="class">.username</span>=sonar
sonar<span class="class">.jdbc</span><span class="class">.password</span>=sonar
</code></pre></li>
<li><p>oclint安装配置</p>
</li>
</ol>
<p>解压oclint到指定目录，并配置环境变量。终端输入<code>oclint</code>，有以下输出说明安装正确:</p>
<pre><code><span class="string">oclint:</span> Not enough positional command line arguments specified!
Must specify at least <span class="number">1</span> positional <span class="string">arguments:</span> <span class="string">See:</span> oclint -help
</code></pre><h3 id="代码扫描">代码扫描</h3><p>进入项目根目录，执行</p>
<pre><code>oclint-json-compilation-database -v -i scanPath/  -- -<span class="built_in">max</span>-<span class="built_in">priority</span>-<span class="number">1</span> <span class="number">10000</span> -<span class="built_in">max</span>-<span class="built_in">priority</span>-<span class="number">2</span> <span class="number">10000</span> -<span class="built_in">max</span>-<span class="built_in">priority</span>-<span class="number">3</span> <span class="number">10000</span> -report-<span class="built_in">type</span> pmd -o oclint.xml
</code></pre><p> 我在执行这个命令的时候，发现命令能执行完成，但是不能生成oclint.xml文件。查了下帮助文件发现有个debug模式：</p>
<pre><code>optional arguments:
  -<span class="ruby">h, --help            show this help message <span class="keyword">and</span> exit
</span>  -<span class="ruby">v                    show invocation command with arguments
</span>  -<span class="ruby">debug, --debug       invoke <span class="constant">OCLint</span> <span class="keyword">in</span> debug mode
</span>  -<span class="ruby">i <span class="constant">INCLUDES</span>, -<span class="keyword">include</span> <span class="constant">INCLUDES</span>, --<span class="keyword">include</span> <span class="constant">INCLUDES</span>
</span>                    extract files matching pattern
  -<span class="ruby">e <span class="constant">EXCLUDES</span>, -exclude <span class="constant">EXCLUDES</span>, --exclude <span class="constant">EXCLUDES</span>
</span>                    remove files matching pattern
</code></pre><p> 但是在执行的时候报错说oclint不支持debug模式。又搜索很久还是无果，无奈进入官方翻了半天在某一页最后一行发现一行小字：<code>debug mode need oclint compile by debug mode</code>，知道真相的我眼泪掉下来，查了文档和stackoverflow最后也没找到如何<code>compile by debug mode</code>。</p>
<p> 然后which到目录看了一下<code>oclint-json-compilation-database</code>是<code>oclint</code>的<code>Python</code>脚本,主要功能就是拼接oclint的参数并开启子进程执行命令：</p>
<pre><code>oclint_invocation = OCLINT_BIN + debug_argument + oclint_arguments + <span class="string">' '</span> + source_paths
<span class="keyword">if</span> args<span class="class">.invocation</span>:
print <span class="string">'------------------------------ OCLint ------------------------------'</span>
print oclint_invocation
print <span class="string">'--------------------------------------------------------------------'</span>
exit_code = subprocess.<span class="function"><span class="title">call</span><span class="params">(oclint_invocation, shell=True)</span></span>
sys.<span class="function"><span class="title">exit</span><span class="params">(exit_code)</span></span>
</code></pre><p>怪不得没有任何输出信息，原来是在子进程里执行的。开启-v模式把拼接的命令直接放入终端执行(因为文件太多，这个命令足足有3屏)，终于出现短短一行的出错信息：<br><code>Segmentation fault: 11</code>。</p>
<p>段错误是Linux系统编程中非常常见的错误，原因主要是非法的内存访问，但是这个段错误没有生成Core dump文件，所以没办法分析具体错误原因。这时我想起了Linux下非常强大的系统级调试工具<code>trace</code>和<code>truss</code>。查了一下在Mac下与之对应的是<code>dtrace</code>和<code>dtruss</code>工具。dtrace一般用于系统函数跟踪，它的优点在于：可以在不影响原有程序运行的情况下调试，跟踪系统调用并生成日志文件。详细用法及说明可以man查看。</p>
<p>执行<code>sudo dtruss -f oclint_invocation &amp;&gt;result.txt</code>分析命令执行情况并把所有输出重定向到result.txt中。打开文件并查找文件中的ERR或者ERROR字样，定位到很多这样的错误：</p>
<pre><code><span class="number">44317</span>/<span class="number">0x485ef</span>:  stat64(<span class="string">"/AppleInternal/XBS/.isChrooted\0"</span>, <span class="number">0x7FFF56824EE8</span>, <span class="number">0x1</span>)         = -<span class="number">1</span> Err<span class="preprocessor">#<span class="number">2</span></span>
<span class="number">44317</span>/<span class="number">0x485ef</span>:  stat64(<span class="string">"/AppleInternal\0"</span>, <span class="number">0x7FFF56824E58</span>, <span class="number">0x1</span>)         = -<span class="number">1</span> Err<span class="preprocessor">#<span class="number">2</span></span>
</code></pre><p>说明是在调用stat64这个函数出错的，出错的返回值是-1，用man查下这个函数的说明：</p>
<pre><code>The stat() <span class="function"><span class="keyword">function</span> <span class="title">obtains</span> <span class="title">information</span> <span class="title">about</span> <span class="title">the</span> <span class="title">file</span> <span class="title">pointed</span> <span class="title">to</span> <span class="title">by</span></span>
 path.  Read, <span class="built_in">write</span> <span class="operator">or</span> execute permission <span class="operator">of</span> <span class="operator">the</span> named <span class="built_in">file</span> is <span class="operator">not</span>
 required, but all <span class="built_in">directories</span> listed <span class="operator">in</span> <span class="operator">the</span> path name leading <span class="built_in">to</span> <span class="operator">the</span> <span class="built_in">file</span>
 must be searchable.

 <span class="constant">RETURN</span> VALUES
 Upon successful completion <span class="operator">a</span> <span class="built_in">value</span> <span class="operator">of</span> <span class="number">0</span> is returned.  Otherwise, <span class="operator">a</span> <span class="built_in">value</span>
 <span class="operator">of</span> -<span class="number">1</span> is returned <span class="operator">and</span> errno is <span class="built_in">set</span> <span class="built_in">to</span> indicate <span class="operator">the</span> error.
</code></pre><p> 这个函数是获取文件信息的，成功返回0，失败返回-1并设置errno。到这里原因就大致清楚了，原因大概是同时分析的文件超过了oclint的上限。修改下参数重新执行就可以了。</p>
<h3 id="导出扫描结果到Sonar">导出扫描结果到Sonar</h3><p>将<code>sonar-project.properties</code>放入代码根目录，根据具体情况修改对应的项，注意必须修改设置<code>sonar.objectivec.project</code>和<code>sonar.objectivec.appScheme</code>。如果是workspace工程，需要设置<code>sonar.objectivec.workspace</code>项。</p>
<p>然后在SonarQube中执行Sonar Runner：<code>sonar-runer.sh</code> （前面已经配置好环境变量，所以这里可以直接执行）。</p>
<p>如果在执行的时候出现<code>java.database.connetion</code>字样的错误，请仔细检查数据库连接及配置信息。</p>
<p>我执行这一步的时候发现导出的结果除了文件信息外其他都是空，仔细的分析了下执行时的log，发现这是SonarQuebe有个bug，SonarQuebe代码分析时默认生成的文件oclint.xml在Sonar-reports目录，但是读取时它会到根目录读取，截止目前为止，SonarQuebe仍有这个bug。解决办法就是把生成的xml文件拷贝到根目录在重新执行<code>sonar-runer.sh</code>。</p>
<p>继续执行的时候出现了<code>Incorrect string value: &#39;\xF0\x90\x8D\x83\xF0\x90...&#39; for column &#39;data&#39; at row 1</code>的错误，开始我以为是编码错误，后来发现是因为是插入数据的大小超过的字段限制的大小,这个也算是SonarQube的bug吧。我试了下，修改对应数据库字段类型longtext为longblob即可。</p>
<p><img src="http://7xorsh.com1.z0.glb.clouddn.com/databaseAlert.jpg" alt="Loading"></p>
<p>执行成功后就可以看到扫描结果了:</p>
<p><img src="http://7xorsh.com1.z0.glb.clouddn.com/scan_result.jpg" alt="Loading"></p>
<p>配合Jira能够更方便的跟踪和分配问题，配合Jenkins能够进行自动化部署和自动化单元测试，我将在以后的文章里纪录Jenkins自动化部署和单元测试的方法。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/12/hello-world/" itemprop="url">
                  MarkDown语法学习
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-03-12T20:37:07+08:00" content="2016-03-12">
              2016-03-12
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>欢迎来到我的<a href="www.liudesheng.com">博客</a>,第一篇我们会学习使用MarkDown语法来书写文章。</p>
<h2 id="标题">标题</h2><p>在Markdown语法中，标题是文本前面加上<code>#</code>来表示的，一个#代表一级标题，同里，还可以增加二级标题，三级标题，最大不能超过六级。例如:</p>
<blockquote>
<pre><code><span class="preprocessor"># 一级标题</span>
<span class="preprocessor">## 二级标题</span>
<span class="preprocessor">### 三级标题</span>
<span class="preprocessor">#### 四级标题</span>
<span class="preprocessor">##### 五级标题</span>
<span class="preprocessor">###### 六级标题</span>
</code></pre></blockquote>
<h2 id="列表">列表</h2><p>无序列表只需在文字前面加上 <code>-</code>。例如：</p>
<blockquote>
<pre><code>-<span class="ruby"> 文本<span class="number">1</span>
</span>-<span class="ruby"> 文本<span class="number">2</span>
</span>-<span class="ruby"> 文本<span class="number">3</span></span>
</code></pre></blockquote>
<p>如果需要创建有序列表，在文字前加上1.2.3.。注意：-、1.和文本之间要保留一个空格。例如:</p>
<blockquote>
<pre><code><span class="number">1.</span> 文本<span class="number">1</span>
<span class="number">2.</span> 文本<span class="number">2</span>
<span class="number">3.</span> 文本<span class="number">3</span>
</code></pre></blockquote>
<h2 id="链接和图片">链接和图片</h2><p>在Markdown中，插入链接需要语法即可。例如:</p>
<blockquote>
<pre><code>[<span class="link_label">博客</span>](<span class="link_url">www.liudesheng.com</span>)
</code></pre></blockquote>
<p>插入图片使用以下的格式：</p>
<blockquote>
<pre><code>!<span class="attr_selector">[]</span>()(<span class="attribute">http</span>:<span class="comment">//weibo.com/hnrain?s=6cm7D0)</span>
</code></pre></blockquote>
<h2 id="引用">引用</h2><p>如果在写作的时候需要引用别人的文字，直接在需要引用的文字前面加<code>&gt;</code>就好。例如：</p>
<blockquote>
<pre><code>这是一段引用的文字。
</code></pre></blockquote>
<h2 id="粗体斜体">粗体斜体</h2><p>用两个<code>*</code>包含的文本是粗体，用一个<code>*</code>包含的文本是斜体。例如:</p>
<blockquote>
<pre><code><span class="keyword">*</span><span class="keyword">*</span>这是粗体<span class="keyword">*</span><span class="keyword">*</span>
<span class="keyword">*</span>这是斜体<span class="keyword">*</span>
</code></pre><p>生存还是<strong>毁灭</strong>,这是一个<em>问题</em>。</p>
</blockquote>
<h2 id="表格">表格</h2><p>在MarkDown中表格的表示方式非常形象。例子如下</p>
<blockquote>
<pre><code>|<span class="string"> table            </span>|<span class="string"> row           </span>|<span class="string"> pes  </span>|
|<span class="string"> -------------     </span>|<span class="string">:-------------:</span>|<span class="string"> -----:</span>|
|<span class="string"> col1              </span>|<span class="string"> right-aligned </span>|<span class="string"> data12345 </span>|
|<span class="string"> col2              </span>|<span class="string"> centered      </span>|<span class="string"> data2 </span>|
|<span class="string"> col3             </span>|<span class="string"> test      </span>|<span class="string">    d3 </span>|
</code></pre></blockquote>
<p>默认居左，横线两边加冒号的是居中，冒号在右边的是居右。效果如下：</p>
<table>
<thead>
<tr>
<th>table</th>
<th style="text-align:center">row</th>
<th style="text-align:right">pes</th>
</tr>
</thead>
<tbody>
<tr>
<td>col1</td>
<td style="text-align:center">right-aligned</td>
<td style="text-align:right">data12345</td>
</tr>
<tr>
<td>col2</td>
<td style="text-align:center">centered</td>
<td style="text-align:right">data2</td>
</tr>
<tr>
<td>col3</td>
<td style="text-align:center">test</td>
<td style="text-align:right">d3</td>
</tr>
</tbody>
</table>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/12/nil0Nil0NULL0null0nullptr0NSNull/" itemprop="url">
                  nil/Nil/NULL/NUL/nullptr/NSNull
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-02-12T10:41:47+08:00" content="2016-02-12">
              2016-02-12
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="如何表示“不存在”">如何表示“不存在”</h2><p>要理解不存在这个概念，首先需要理解存在。如何定义“存在”这个概念是一个哲学问题，海德格尔在《存在与时间》中提及了存在的不可定义性。原文如下：</p>
<blockquote>
<p>『存在』这个概念是不可定义的。这是从它的最高普遍性推论出来的。这话有道理——既然定义来自最近的种加属差。确实不能把『存在』理解为存在者，令存在者归属于存在并不能使『存在』得到规定。</p>
</blockquote>
<p>对于哲学来说，表示存在或者不存在这个概念是比较困难的问题。对于数学和计算机科学来说，表示不存在要简单的多，就是用存在的概念表示不存在概念。</p>
<h2 id="NULL">NULL</h2><p>NULL一般是这么定义的：</p>
<pre><code><span class="id">#ifdef</span> __cplusplus  
<span class="hexcolor">#def</span>ine NULL    <span class="number">0</span>  
<span class="id">#else</span>  
<span class="hexcolor">#def</span>ine NULL    ((void *)<span class="number">0</span>)  
<span class="id">#endif</span>  
</code></pre><p> 可以看出在C和C++中NULL的定义不同。在C语言中，不需要考虑函数重载等问题，所以直接简单定义为一个0地址的<code>void*</code>就行了。由于C++引入了更严格的类型检查，所以把直接<code>void*</code>类型的值赋给一个有类型指针是不行的，编译器会报错(eg:<code>malloc</code>)。但同时C++要保持和C的兼容性，所以在C++里，<code>NULL</code>直接定义为整型0。</p>
<h2 id="nullptr">nullptr</h2><p>将<code>NULL</code>直接定义成0一般是没问题的，但是假如遇到函数重载：</p>
<pre><code><span class="function"><span class="keyword">int</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">void</span> *ptr)</span></span>;
<span class="function"><span class="keyword">int</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>;
</code></pre><p>如果这样调用<code>foo(1,NULL)</code>就会有歧义，因为NULL是指针类型，但是同时NULL也是整型。同样的，这样的问题在模版类型推导的时候也会出现：</p>
<pre><code><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<span class="function"><span class="keyword">int</span> <span class="title">foo</span><span class="params">(T a)</span></span>;
</code></pre><p>如果调用<code>foo(NULL)</code>是应该推导出<code>int foo(int a)</code>呢还是<code>int foo(void *a)</code>呢。为了解决这个问题。C++11引入了一个新的概念：nullptr。nullptr的实现如下：</p>
<pre><code> <span class="keyword">const</span>
<span class="keyword">class</span> <span class="keyword">nullptr_t</span>
{
<span class="keyword">public</span>:
<span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<span class="keyword">inline</span> <span class="keyword">operator</span> T*() <span class="keyword">const</span>
    { <span class="keyword">return</span> <span class="number">0</span>; }
<span class="keyword">template</span>&lt;<span class="keyword">class</span> C, <span class="keyword">class</span> T&gt;
<span class="keyword">inline</span> <span class="keyword">operator</span> T C::*() <span class="keyword">const</span>
    { <span class="keyword">return</span> <span class="number">0</span>; }

<span class="keyword">private</span>:
    <span class="keyword">void</span> <span class="keyword">operator</span>&amp;() <span class="keyword">const</span>;
} <span class="literal">nullptr</span> = {};
</code></pre><p>其实<code>nullptr</code>和swift中的<code>Optional</code>的实现非常像了。看了nullptr的实现，可以自己写一个Optional的实现。我会在下一篇博客去介绍Optional。</p>
<h2 id="nil">nil</h2><p>nil和NULL语义不同，但是在底层实现上是等价的。需要注意的是，nil可以向对象发送消息，如果消息有返回值，会有以下几种情况：</p>
<ul>
<li>如果一个方法返回值是一个对象，那么发送给nil的消息将返回0(nil)。</li>
<li>如果方法返回值为指针类型，其指针大小为小于或者等于sizeof(void*)，float，double，long double 或者long long的整型标量，发送给nil的消息将返回0。</li>
<li>如果方法返回值为结构体，发送给nil的消息将返回0。结构体中各个字段的值将都是0。其他的结构体数据类型将不是用0填充的。</li>
<li>如果方法的返回值不是上述提到的几种情况，那么发送给nil的消息的返回值将是未定义的。</li>
</ul>
<h2 id="Nil">Nil</h2><p>Nil是OC类类型的书面空值，对应<code>Class</code>类型对象。底层实现和nil是一样的。Nil的定义如下：</p>
<pre><code><span class="preprocessor">#<span class="keyword">ifndef</span> Nil</span>
<span class="preprocessor"># <span class="keyword">if</span> __has_feature(cxx_nullptr)</span>
<span class="preprocessor">#   <span class="keyword">define</span> Nil nullptr</span>
<span class="preprocessor"># <span class="keyword">else</span></span>
<span class="preprocessor">#   <span class="keyword">define</span> Nil __DARWIN_NULL</span>
<span class="preprocessor"># <span class="keyword">endif</span></span>
<span class="preprocessor">#<span class="keyword">endif</span></span>

<span class="preprocessor">#<span class="keyword">ifndef</span> nil</span>
<span class="preprocessor"># <span class="keyword">if</span> __has_feature(cxx_nullptr)</span>
<span class="preprocessor">#   <span class="keyword">define</span> nil nullptr</span>
<span class="preprocessor"># <span class="keyword">else</span></span>
<span class="preprocessor">#   <span class="keyword">define</span> nil __DARWIN_NULL</span>
<span class="preprocessor"># <span class="keyword">endif</span></span>
<span class="preprocessor">#<span class="keyword">endif</span></span>
</code></pre><h2 id="NSNull">NSNull</h2><p>在OC的集合中中nil代表集合的结束，所以不能在集合里存储nil。所以就有了NSNull用一个类来表示空值。一般用来表示集合中的空对象。</p>
<h2 id="NUL">NUL</h2><p>用来表示字符串的结束。注意：标准C中无定义。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/07/不经意间/" itemprop="url">
                  你在哪里
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-02-07T19:33:15+08:00" content="2016-02-07">
              2016-02-07
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>不经意抬眼看见逐渐黯淡的黄昏</p>
<p>难以言喻的风景浮现出你的身影</p>
<p>若一切终将如清风般虚妄的飘散</p>
<p>那让这思绪也随之散去又有何妨</p>
<hr>
<p>启程于春 从那天清晨起踏上旅途</p>
<p>时至盛夏 怀想你我曾共赏的夜幕</p>
<p>阴冷深秋 黑夜覆盖了傍晚的天际</p>
<p>唤来隆冬 转眼又是一轮四季交替</p>
<p>飞花乱舞 参杂在纷繁的夜景深处</p>
<p>星辰陨落 款款光芒道出你的踪迹</p>
<p>月光倾洒 刻画出两条长长的身影</p>
<p>雪花飘散 掩埋往复的一年又一年</p>
<p>而你的身影依然遥远……</p>
<hr>
<p>有一种事物一任四季变迁依然如故</p>
<p>因为我将它年复一年的埋藏于心底</p>
<p>若这飘渺歌声几经呼唤也无法传达</p>
<p>请让它如失散的歌谣般在世间回荡</p>
<hr>
<p>渡过劫难 我与你的相逢突如其来</p>
<p>梦中时空 那一切便真的宛若梦境</p>
<p>幻想之乡 延展开无边无际的世界</p>
<p>怪奇相谈 就像是和你正两手相牵</p>
<p>红魔事变 将两人的命运写下定数</p>
<p>妖妖梦幻 一幕幕又怎可能是幻觉</p>
<p>永久之夜 不知将持续到几时几刻</p>
<hr>
<p>为何我们拥抱在一起 我却无法寻得你的所在</p>
<p>你的视线彼岸究竟是谁的身影</p>
<p>谁能来 回答我…..</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/30/Xcode升级之后Alcatraz和插件失效/" itemprop="url">
                  Xcode升级之后Alcatraz和插件失效
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-01-30T13:31:11+08:00" content="2016-01-30">
              2016-01-30
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p><a href="http://alcatraz.io" target="_blank" rel="external">Alcatraz</a>是一个非常好用的插件管理器。前一段时间把Xcode升级到了7.2之后Alcatraz失效了，而且之前安装的所有插件也都消失了。查了资料才知道Apple为了避免插件造成新版本的Xcode启动时崩溃，所以只允许匹配<code>DVTPlugInCompatibilityUUIDs</code>的插件被加载。</p>
<p>可以通过下面的方法激活之前安装的插件：</p>
<blockquote>
<pre><code><span class="keyword">find</span> ~<span class="regexp">/Library/</span>Application\ Support<span class="regexp">/Developer/</span>Shared<span class="regexp">/Xcode/</span>Plug-ins -name Info.plist -maxdepth <span class="number">3</span> | xargs -I{} defaults <span class="keyword">write</span> {} DVTPlugInCompatibilityUUIDs -array-add `defaults <span class="keyword">read</span> <span class="regexp">/Applications/</span>Xcode.app<span class="regexp">/Contents/I</span>nfo DVTPlugInCompatibilityUUID`
</code></pre></blockquote>
<p>另外如果你不小心在Xcode启动的时候点击了 <strong>Skip Bundle</strong>,你可以通过下面的方式避免重新安装的悲剧。</p>
<blockquote>
<pre><code>defaults <span class="keyword">delete</span> com.apple.dt.Xcode DVTPlugInManagerNonApplePlugIns-Xcode-{your_xcode_version} 
</code></pre></blockquote>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/11/24/Hello-World-0/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-11-24T10:38:41+08:00" content="2015-11-24">
              2015-11-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分類於
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/新测试/" itemprop="url" rel="index">
                    <span itemprop="name">新测试</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="这是一个文章标题测试">这是一个文章标题测试</h1><h2 id="markdown语法二级标题">markdown语法二级标题</h2><h3 id="代码测试">代码测试</h3><pre><code>- (<span class="keyword">void</span>)longPress:(UILongPressGestureRecognizer *)press {
    <span class="keyword">if</span> (press.state == UIGestureRecognizerStateBegan) {
        <span class="keyword">int</span> <span class="keyword">index</span> = (<span class="keyword">int</span>)press.view.tag - KIMGTAG;
        <span class="keyword">if</span> (<span class="keyword">index</span> &lt; <span class="number">0</span> || <span class="keyword">index</span> &gt;= _smallImgs.<span class="keyword">count</span>) {
            <span class="keyword">return</span>;
        }
        [_smallImgs removeObjectAtIndex:<span class="keyword">index</span>];
        [self updateAll];
    }
}
</code></pre>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="http://7xorsh.com1.z0.glb.clouddn.com/headIcon.jpg" alt="刘得胜" itemprop="image"/>
          <p class="site-author-name" itemprop="name">刘得胜</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">16</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">1</span>
              <span class="site-state-item-name">分類</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">10</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘得胜</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
